@model Kigg.Web.StoryContentViewData
@using hbehr.recaptcha
@using Kigg
@using Kigg.Web

@{
    GenerateScripts();

    Page.Header.Title = "{0} - Dodaj nowy artykuł".FormatWith(Model.SiteTitle);
}

@functions {
    private void GenerateScripts()
    {
        jQueryScriptManager scriptManager = jQueryScriptManager.Current;

        scriptManager.RegisterSource(Url.Asset("js3"));

        scriptManager.RegisterOnReady("Story.set_autoDiscover({0});".FormatWith(Model.AutoDiscover.ToString().ToLowerInvariant()));
        scriptManager.RegisterOnReady("Story.set_captchaEnabled({0});".FormatWith(Model.CaptchaEnabled.ToString().ToLowerInvariant()));

        if (Model.AutoDiscover)
        {
            scriptManager.RegisterOnReady("Story.set_retrieveStoryUrl('{0}');".FormatWith(Url.RouteUrl("Retrieve")));
        }

        scriptManager.RegisterOnReady("Story.set_suggestTagsUrl('{0}');".FormatWith(Url.RouteUrl("SuggestTags")));

        scriptManager.RegisterOnReady("Story.init()");
        scriptManager.RegisterOnDispose("Story.dispose();");
    }
}

@Html.PageHeader("Dodaj nowy artykuł")
<span class="pageMessage">Wypełnij formularz, aby dodać artykuł</span>
<form id="frmStorySubmit" action="@Url.Action("Submit", "Story")" method="post">
    <fieldset>
        <div class="add-article-row row">
            <label for="txtStoryUrl" class="label offset-1 col-2">
                Url:
            </label>
            <div class="col-9">
                <input id="txtStoryUrl" name="url" type="text" class="largeTextBox col-7" value="@Model.Url" />
                <span id="errorStoryUrl" class="error"></span>
            </div>
        </div>
        <div class="add-article-row row">
            <label for="txtStoryTitle" class="label offset-1 col-2">
                Tytuł:
            </label>
            <div class="col-9">
                <input id="txtStoryTitle" name="title" type="text" class="largeTextBox col-7" value="@Model.Title" />
                <span class="error"></span>
            </div>
        </div>
        <div class="add-article-row row">
            <label for="txtStoryDescription" class="label offset-1 col-2">
                Opis:
            </label>
            <div class="col-md-7">
                <input type="hidden" id="hidDescription" name="description" />
                <textarea id="txtStoryDescription" name="storyDescription" cols="52" rows="4">@Model.Description</textarea>

                <div class="wysiwyg-code">
                    <div id="storyPreview" class="livePreview wysiwyg-code2">
                    </div>
                </div>
                <a id="lnkStoryPreview" class="actionLink hide-sample" href="javascript:void(0)">
                    ukryj
                    podgląd
                </a>
            </div>
            <span class="error"></span>
        </div>
        <div class="add-article-row row">
            <label for="txtStoryTags" class="label offset-1 col-2">
                Tagi:
            </label>
            <div class="col-9">
                <input id="txtStoryTags" name="tags" type="text" class="largeTextBox col-7" />
                <span class="info">(oddziel przecinkiem wiele tagów)</span>
                <span class="error"></span>
            </div>
        </div>
        <div class="add-article-row radios-wrapper row">
            <label class="label offset-1 col-2">
                Kategoria:
            </label>
            <div class="col-9">
                @{ Html.RenderAction("RadioButtonList", "Category"); }
                <div class="clearfix"></div>
                <span class="error"></span>
            </div>
        </div>
        @if (Model.CaptchaEnabled)
        {
            <div class="add-article-row">
                <label>Captcha:</label>
                <div style="float: left;">
                    @ReCaptcha.GetCaptcha()
                </div>
            </div>
        }
        <div class="add-article-row" id="storyMessage"></div>
        <div class="articleHeader">
        </div>
        <div class="add-article-row">
            <input id="btnStorySubmit" type="submit" class="largeButton" value="Dodaj" />
        </div>
    </fieldset>
</form>